-- BASIC 2x2 TUNNEL MINER

-- === STATE ===
local fuelThreshold = 2

-- === HELPERS ===
local function notify(msg)
  print(msg)
end

function moveForwardSafe()
  if turtle.getFuelLevel() < fuelThreshold then
    notify("Fuel low. Returning.")
    returnToStart()
    return false
  end
  while not turtle.forward() do turtle.dig() sleep(0.1) end
  return true
end

function moveDownSafe()
  while not turtle.down() do turtle.digDown() sleep(0.1) end
end

function moveUpSafe()
  while not turtle.up() do turtle.digUp() sleep(0.1) end
end

function returnToStart()
  turtle.turnLeft()
  turtle.turnLeft()
  for i = 1, 10 do  -- assumes 10 blocks forward
    if not turtle.forward() then break end
  end
  turtle.turnLeft()
  turtle.turnLeft()
  notify("Returned to start.")
end

function dig2x2()
  for i = 1, 10 do
    if not moveForwardSafe() then break end
    turtle.digUp()
    moveUpSafe()
    turtle.dig()
    moveForwardSafe()
    turtle.digDown()
    moveDownSafe()
    turtle.turnLeft()
    turtle.turnLeft()
    moveForwardSafe()
    turtle.turnLeft()
    turtle.turnLeft()
  end
end

-- MAIN EXECUTION
function main()
  notify("Starting 2x2 tunnel...")
  dig2x2()
  returnToStart()
end

main()
